let isEnableExtension=!0,crrId=0;function start(){loadHostRulesFromStorage();try{chrome.contextMenus.create({title:"Block this element",id:"t-special-block-element",contexts:["page","selection","link","editable","image","video","audio"]}),chrome.contextMenus.onClicked.addListener(onContextClick)}catch(e){console.log(e)}}function stop(){removeAllRules();try{chrome.contextMenus.remove("t-special-block-element")}catch(e){console.log(e)}}chrome.runtime.onMessage.addListener((e,t,s)=>{switch(e.name){case"disable-host-block":isEnableExtension=!1,stop();break;case"enable-host-block":isEnableExtension=!0,start();break;case"update-user-host-block":isEnableExtension&&loadHostRulesFromStorage()}}),start();const fetchTextFileByLine=e=>fetch(e).then(e=>e.text()).then(e=>e.split("\n"));function onContextClick(e,t){"t-special-block-element"==e.menuItemId&&chrome.tabs.sendMessage(t.id,{name:"start-block-by-menucontext"},{frameId:e.frameId})}function getFromChromeStorage(e){return new Promise((t,s)=>chrome.storage.sync.get(e,e=>chrome.runtime.lastError?s(chrome.runtime.lastError.message):t(e)))}const disableAllRules=()=>{if(crrId>0){let e=[];for(let t=1;t<=crrId;t++)e.push(t);chrome.declarativeNetRequest.updateDynamicRules({disableRulesetIds:e})}},removeAllRules=()=>{if(crrId>0){let e=[];for(let t=1;t<=crrId;t++)e.push(t);return chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:e})}},setBlockHosts=e=>{removeAllRules(),e.filter(e=>"#"!=e[0]).forEach((e,t)=>{if(crrId=t+1,e)try{chrome.declarativeNetRequest.updateDynamicRules({addRules:[{id:crrId,priority:1,action:{type:"block"},condition:{urlFilter:e,resourceTypes:["main_frame"]}}],removeRuleIds:[crrId]})}catch(s){console.log(s)}})};function handleBlockHostByTextInUrl(e){return fetchTextFileByLine(e).then(e=>{setBlockHosts(e)})}function loadHostRulesFromStorage(){getFromChromeStorage("hostRules").then(({hostRules:e})=>{e&&setBlockHosts(e)})}