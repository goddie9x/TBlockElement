let currentTab,isPowerOn,powerSwitch=document.querySelector(".power-switcher"),quickSelectBtn=document.querySelector(".quick-select"),startSelectBtn=document.querySelector(".start-select"),restartPageBtn=document.querySelector(".restart-btn"),openSettingsBtn=document.querySelector(".open-setting"),getEnableExtensionStatus=getFromChromeStorage("disableExtensionForUrl"),currentHostElement=document.querySelector(".current-host"),expandMenuBtn=document.querySelector(".expand-menu-btn"),expandMenu=document.querySelector(".expand-menu"),unblockCopyBtn=document.querySelector(".unblock-copy"),unblockScrollBtn=document.querySelector(".unblock-scroll"),clearDataBtn=document.querySelector(".clear-data"),currentHost,generalSetingsInfo,isContentLoaded=!1;const selectTypes=["interval","timeout","onscroll","onload"];function saveToChromeStorage({key:a,value:b}){return new Promise((c,d)=>chrome.storage.sync.set({[a]:b},()=>chrome.runtime.lastError?d(chrome.runtime.lastError.message):c(()=>{console.log(`${a} saved`)})))}function replaceStringWithMultipleValues(b,a,c){let d=b;return Array.isArray(c)?a.forEach((a,b)=>{d=d.replace(a,c[b])}):a.forEach(a=>{d=d.replace(a,c)}),d}function getFromChromeStorage(a){return new Promise((b,c)=>chrome.storage.sync.get(a,a=>chrome.runtime.lastError?c(chrome.runtime.lastError.message):b(a)))}function setAttributes(b,c){try{for(var d in c){let a=c[d];"object"==typeof a?setAttributes(b,a):b.setAttribute(d,a)}}catch(e){console.log(e)}}function addMultipleClass(c,a){try{a.forEach(a=>c.classList.add(a))}catch(b){console.log(b)}}function removeMultipleClass(c,a){try{a.forEach(a=>c.classList.remove(a))}catch(b){console.log(b)}}function showAlertMessage({title:c,message:d,type:e="info",buttons:b=[],onClose:g,timeOut:f=3e3}){let a=document.createElement("div");addMultipleClass(a,["alert","alert-"+e,"fade","show","t-spec-block-alert"]),a.innerHTML=`
        <h4>${c}</h4>
        <p>${d}</p>
    `,b&&b.forEach(c=>{let b=document.createElement("button");b.innerHTML=c.text,b.addEventListener("click",c.onClick),a.appendChild(b)}),document.body.appendChild(a),setTimeout(()=>{a.remove(),g&&g()},f)}function toggleClassWithCondition(c,a,b){b?a.forEach(a=>{c.classList.add(a)}):a.forEach(a=>{c.classList.remove(a)})}function setValueForGeneralSettings(a){return getFromChromeStorage("generalSetings").then(({generalSetings:b})=>{for(let c in b||(b={}),a)b[c]=a[c];return saveToChromeStorage({key:"generalSetings",value:b})})}function powerSwitchHandler(a){setDisableExtensionStatusForUrl(currentHost,isPowerOn=a.target.checked)}function senMessageToContentJs(a){chrome.tabs.sendMessage(currentTab.id,a)}function clearChromeExtentionData(){chrome.storage.local.clear(),chrome.storage.sync.clear(),alert("Data cleared")}function setDisableExtensionStatusForUrl(a,b){getEnableExtensionStatus.then(({disableExtensionForUrl:c})=>(c||(c=""),b?c=c.replace("|"+a,""):c.includes(a)||(c+=c?"|"+a:a),saveToChromeStorage({key:"disableExtensionForUrl",value:c}))).then(()=>{b?senMessageToContentJs({name:"enable-blocking"}):senMessageToContentJs({name:"disable-blocking"})})}powerSwitch.addEventListener("change",powerSwitchHandler),expandMenuBtn.addEventListener("click",()=>{expandMenu.classList.toggle("d-none")?expandMenuBtn.innerHTML='<i class="fas fa-chevron-down"></i>':expandMenuBtn.innerHTML='<i class="fas fa-chevron-up"></i>'}),restartPageBtn.addEventListener("click",()=>{isPowerOn&&senMessageToContentJs({name:"restart-page"})}),openSettingsBtn.addEventListener("click",()=>{chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("options.html"))}),unblockCopyBtn.addEventListener("click",a=>{isPowerOn&&setValueForGeneralSettings({isEnableAutoUnblockCopy:a.target.classList.toggle("active")}).then(()=>{senMessageToContentJs({name:"unblock-copy"})}).catch(()=>showAlertMessage({title:"Error",message:"Something went wrong please try agian",type:"danger"}))}),unblockScrollBtn.addEventListener("click",a=>{isPowerOn&&setValueForGeneralSettings({isEnableAutoUnblockScroll:a.target.classList.toggle("active")}).then(()=>{senMessageToContentJs({name:"unblock-scroll"})}).catch()}),clearDataBtn.addEventListener("click",()=>{isPowerOn&&clearChromeExtentionData()}),chrome.tabs.query({active:!0,currentWindow:!0,url:"<all_urls>"},b=>{let[a]=b;currentTab=a,currentHost=new URL(a.url).hostname,currentHostElement.innerHTML=currentHost,getEnableExtensionStatus.then(({disableExtensionForUrl:a})=>{a&&a.includes(currentHost)?(powerSwitch.checked=!1,isPowerOn=!1):(powerSwitch.checked=!0,isPowerOn=!0)})}),chrome.runtime.onMessage.addListener(function(a,c,b){switch(a.name){case"loaded-content":isContentLoaded=!0,quickSelectBtn.innerHTML='<i class="fa-solid fa-jet-fighter"></i>',startSelectBtn.innerHTML='<i class="fas fa-plus"></i>',quickSelectBtn.addEventListener("click",()=>{isPowerOn&&senMessageToContentJs({name:"quick-select"})}),startSelectBtn.addEventListener("click",()=>{isPowerOn&&senMessageToContentJs({name:"start-select"})});break;case"loaded-content-error":b("error")}});let tCheckLoadedContent=setInterval(()=>{isContentLoaded?clearInterval(tCheckLoadedContent):senMessageToContentJs({name:"check-content-loaded"})},1e3);function getGeneralSettings(a){return getFromChromeStorage("generalSetings").then(({generalSetings:b})=>{generalSetingsInfo=b,a&&(b||(b={}),a(b))})}getGeneralSettings(a=>{a.isEnableAutoUnblockCopy&&unblockCopyBtn.classList.add("active"),a.isEnableAutoUnblockScroll&&unblockScrollBtn.classList.add("active")})