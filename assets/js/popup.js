let currentTab,isPowerOn;const IDBG=0;let powerSwitch=document.querySelector(".power-switcher"),quickSelectBtn=document.querySelector(".quick-select"),startSelectBtn=document.querySelector(".start-select"),restartPageBtn=document.querySelector(".restart-btn"),openSettingsBtn=document.querySelector(".open-setting"),getEnableExtensionStatus=getFromChromeStorage("disableExtensionForUrl"),currentHostElement=document.querySelector(".current-host"),expandMenuBtn=document.querySelector(".expand-menu-btn"),expandMenu=document.querySelector(".expand-menu"),unblockCopyBtn=document.querySelector(".unblock-copy"),unblockScrollBtn=document.querySelector(".unblock-scroll"),clearDataBtn=document.querySelector(".clear-data"),rateBtn=document.querySelector(".rating"),currentHost,generalSetingsInfo,isContentLoaded=!1;function saveToChromeStorage({key:e,value:t}){return new Promise((n,r)=>chrome.storage.sync.set({[e]:t},()=>chrome.runtime.lastError?r(chrome.runtime.lastError.message):n(()=>{console.log(`${e} saved`)})))}function replaceStringWithMultipleValues(e,t,n){let r=e;return Array.isArray(n)?t.forEach((e,t)=>{r=r.replace(e,n[t])}):t.forEach(e=>{r=r.replace(e,n)}),r}function getFromChromeStorage(e){return new Promise((t,n)=>chrome.storage.sync.get(e,e=>chrome.runtime.lastError?n(chrome.runtime.lastError.message):t(e)))}function setAttributes(e,t){try{for(var n in t){let r=t[n];"object"==typeof r?setAttributes(e,r):e.setAttribute(n,r)}}catch(a){console.log(a)}}function addMultipleClass(e,t){try{t.forEach(t=>e.classList.add(t))}catch(n){console.log(n)}}function removeMultipleClass(e,t){try{t.forEach(t=>e.classList.remove(t))}catch(n){console.log(n)}}function showAlertMessage({title:e,message:t,type:n="info",buttons:r=[],onClose:a,timeOut:s=3e3}){let o=document.createElement("div");addMultipleClass(o,["alert","alert-"+n,"fade","show","t-spec-block-alert"]),o.innerHTML=`
        <h4>${e}</h4>
        <p>${t}</p>
    `,r&&r.forEach(e=>{let t=document.createElement("button");t.innerHTML=e.text,t.addEventListener("click",e.onClick),o.appendChild(t)}),document.body.appendChild(o),setTimeout(()=>{o.remove(),a&&a()},s)}function toggleClassWithCondition(e,t,n){n?t.forEach(t=>{e.classList.add(t)}):t.forEach(t=>{e.classList.remove(t)})}function setValueForGeneralSettings(e){return getFromChromeStorage("generalSetings").then(({generalSetings:t})=>{for(let n in t||(t={}),e)t[n]=e[n];return saveToChromeStorage({key:"generalSetings",value:t})})}function powerSwitchHandler(e){setDisableExtensionStatusForUrl(currentHost,isPowerOn=e.target.checked)}function sendMessage(e,t){chrome.tabs.sendMessage(currentTab.id,e,function(e){chrome.runtime.lastError,t&&t(e)})}function clearChromeExtentionData(){chrome.storage.local.clear(),chrome.storage.sync.clear(),alert("Data cleared")}function setDisableExtensionStatusForUrl(e,t){getEnableExtensionStatus.then(({disableExtensionForUrl:n})=>(n||(n=""),t?n=(n=n.replace("|"+e,"")).replace(e,""):n.includes(e)||(n+=n?"|"+e:e),saveToChromeStorage({key:"disableExtensionForUrl",value:n}))).then(()=>{t?sendMessage({name:"enable-blocking"}):sendMessage({name:"disable-blocking"})})}powerSwitch.addEventListener("change",powerSwitchHandler),expandMenuBtn.addEventListener("click",()=>{expandMenu.classList.toggle("d-none")?expandMenuBtn.innerHTML='<i class="fas fa-chevron-down"></i>':expandMenuBtn.innerHTML='<i class="fas fa-chevron-up"></i>'}),rateBtn.addEventListener("click",()=>{sendMessage({name:"move-to-rate-page"})}),restartPageBtn.addEventListener("click",()=>{isPowerOn&&sendMessage({name:"restart-page"})}),openSettingsBtn.addEventListener("click",()=>{chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("options.html"))}),unblockCopyBtn.addEventListener("click",e=>{isPowerOn&&setValueForGeneralSettings({isEnableAutoUnblockCopy:unblockCopyBtn.classList.toggle("active")}).then(()=>{sendMessage({name:"unblock-copy"})}).catch(()=>showAlertMessage({title:"Error",message:"Something went wrong please try agian",type:"danger"}))}),unblockScrollBtn.addEventListener("click",e=>{isPowerOn&&setValueForGeneralSettings({isEnableAutoUnblockScroll:unblockScrollBtn.classList.toggle("active")}).then(()=>{sendMessage({name:"unblock-scroll"})}).catch(()=>showAlertMessage({title:"Error",message:"Something went wrong please try agian",type:"danger"}))}),clearDataBtn.addEventListener("click",()=>{isPowerOn&&clearChromeExtentionData()}),chrome.tabs.query({active:!0,currentWindow:!0,url:"<all_urls>"},e=>{let[t]=e;currentTab=t,currentHost=new URL(t.url).hostname,currentHostElement.innerHTML=currentHost,getEnableExtensionStatus.then(({disableExtensionForUrl:e})=>{e&&e.includes(currentHost)?(powerSwitch.checked=!1,isPowerOn=!1):(powerSwitch.checked=!0,isPowerOn=!0)})}),chrome.runtime.onMessage.addListener(function(e,t,n){switch(e.name){case"loaded-content":isContentLoaded=!0,quickSelectBtn.innerHTML='<i class="fa-solid fa-jet-fighter"></i>',startSelectBtn.innerHTML='<i class="fas fa-plus"></i>',quickSelectBtn.addEventListener("click",()=>{isPowerOn&&sendMessage({name:"quick-select"})}),startSelectBtn.addEventListener("click",()=>{isPowerOn&&sendMessage({name:"start-select"})});break;case"loaded-content-error":n("error");break;case"unselect-last-element-content":sendMessage({name:"unselect-last-element"})}});let tCheckLoadedContent=setInterval(()=>{isContentLoaded?clearInterval(tCheckLoadedContent):sendMessage({name:"check-content-loaded"})},1e3);function getGeneralSettings(e){return getFromChromeStorage("generalSetings").then(({generalSetings:t})=>{generalSetingsInfo=t,e&&(t||(t={}),e(t))})}getGeneralSettings(e=>{e.isEnableAutoUnblockCopy&&unblockCopyBtn.classList.add("active"),e.isEnableAutoUnblockScroll&&unblockScrollBtn.classList.add("active")});